<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Jason Thorpe [ jdthorpe_at_gmail.com ]" />

<meta name="date" content="2015-04-21" />

<title>A Practical Guide to the PEB</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">A Practical Guide to the PEB</h1>
<h4 class="author"><em>Jason Thorpe [ jdthorpe_at_gmail.com ]</em></h4>
<h4 class="date"><em>2015-04-21</em></h4>
</div>


<div id="parameters-for-the-parametric-empirical-bayes-algorithm" class="section level1">
<h1>Parameters for the Parametric Empirical Bayes Algorithm</h1>
<p>When using the Parametric Empirical Bayes (PEB) algorithm to set personalized thresholds for a biomarker, it is necessary estimate the population average (<code>mu</code>) for the biomarker as well as the within- and between-person variation of that marker (sigma squared [<code>s2</code>] and tau squared[<code>t2</code>], respectively). A dataset with observed marker levels from a population of healthy individuals (the ‘prior population’ here on), at least some of whom have marker levels taken from multiple time points (‘prior observations’) is required to estimate each of these parameters.</p>
<div id="parameter-estimates-with-equal-ks" class="section level2">
<h2>Parameter estimates with equal k’s</h2>
<p>In the case that each member of the prior population contributes equal numbers of prior observations, the mean of all prior observations is a minimum variance unbiased (MVU) estimate of the population mean and the mean of the within person variance estimates is an MVU estimate of <code>s2</code>, and the <code>var(m_i) - (s2/k)</code> is an MVU estimate of the <code>s2</code>. Note that excess variation attributable to the process of estimating the within person means (<code>m_i</code>) is subtracted from the sample variance (<code>var(m_i)</code>).</p>
<p>To illustrate the process of estimating these parameters, a random prior population can be generated as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The number of individuals in the prior population</span>
N =<span class="st"> </span><span class="dv">20</span> 

<span class="co"># The numbers of prior observations per individual</span>
k =<span class="st"> </span><span class="dv">5</span> 

<span class="co"># a vector of person id's</span>
id =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">seq</span>(N),<span class="dt">times=</span>k), <span class="dt">levels=</span><span class="kw">seq</span>(N))

<span class="co"># random personal means</span>
x1 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">rnorm</span>(N),<span class="dt">times=</span>k)

<span class="co"># random within person variation</span>
x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N*k) 

<span class="co"># the interclass correlation coefficient, defined as 't2/(s2 + t2)'</span>
beta &lt;-<span class="st"> </span>.<span class="dv">6</span>

<span class="co"># random marker levels with ICC = beta</span>
x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(beta)*x1 +<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span>-beta)*x2

mu =<span class="st"> </span><span class="kw">mean</span>(x)
s2 =<span class="st"> </span><span class="kw">mean</span>(<span class="kw">tapply</span>(x,id,var))
t2 =<span class="st"> </span><span class="kw">var</span>(<span class="kw">tapply</span>(x,id,mean))-<span class="st"> </span>(s2/k)
<span class="kw">c</span>(mu,s2,t2)
<span class="co">#&gt; [1] 0.04088355 0.49867392 0.84845032</span></code></pre>
<p>The function <code>PEBparams()</code> calculates <em>initital</em> estimates for <code>mu</code>, <code>s2</code>, and <code>t2</code> in exactly this way when the <code>'iterative'</code> is specified.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'PEB'</span>)
params &lt;-<span class="st"> </span><span class="kw">PEBparams</span>(x,id,<span class="dt">method=</span><span class="st">'iterative'</span>,<span class="dt">iterations=</span><span class="dv">1</span>)
params
<span class="co">#&gt; mu: 0.04088 [ -0.3173 , 0.399 ]</span>
<span class="co">#&gt; sigma^2: 0.4987 [ 0.6351 , 0.3764 ]</span>
<span class="co">#&gt; tau^2: 0.8485 [ 1.377 , 0.4326 ]</span>
<span class="co">#&gt; Calculated using 100 observations, from  20 inidividuals.</span>
<span class="co">#&gt; ([x,y] indicates the 90% confidence interval for each parameter)</span>

<span class="co"># The individual parameters can be extracted via:</span>
<span class="kw">c</span>(params$mu,params$s2,params$t2)
<span class="co">#&gt; [1] 0.04088355 0.49867392 0.84845032</span></code></pre>
<p>Note that in addition to each of the required parameters , <code>PEBparams(...,method='iterative')</code> also estimates the error variances for each parameter which are used calculate confidence intervals. The error variances can be viewed via:</p>
<pre class="sourceCode r"><code class="sourceCode r">params[<span class="kw">c</span>(<span class="st">'mu.ev'</span>,<span class="st">'t2.ev'</span>,<span class="st">'s2.ev'</span>)]
<span class="co">#&gt; $mu.ev</span>
<span class="co">#&gt; [1] 0.04740926</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $t2.ev</span>
<span class="co">#&gt; [1] 0.09488604</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $s2.ev</span>
<span class="co">#&gt; [1] 0.006216892</span></code></pre>
</div>
<div id="parameter-estimates-with-unequal-ks" class="section level2">
<h2>Parameter estimates with unequal k’s</h2>
<p>In practice, the prior population will typically be a convenience population, which is unlikely to be structured with equal numbers of observations from every individual.</p>
<p>A convenience population can be simulated as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># number of individuals in the prior population</span>
N =<span class="st"> </span><span class="dv">20</span> 

<span class="co"># distribution of numbers of observations per individual</span>
d =<span class="st"> </span><span class="dv">2</span>:<span class="dv">5</span> 

<span class="co"># numbers of prior observations from each individual</span>
k &lt;-<span class="st"> </span><span class="kw">sample</span>(d,N,<span class="dt">replace=</span><span class="ot">TRUE</span>)

<span class="co"># a vector of person id's</span>
id =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">seq</span>(N),<span class="dt">times=</span>k), <span class="dt">levels=</span><span class="kw">seq</span>(N))

<span class="co"># random personal means</span>
x1 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">rnorm</span>(N),<span class="dt">times=</span>k)

<span class="co"># random within person variation</span>
x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">sum</span>(k)) 

<span class="co"># the interclass correlation coefficient</span>
beta &lt;-<span class="st"> </span>.<span class="dv">6</span>

<span class="co"># random marker levels with ICC = beta</span>
x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(beta)*x1 +<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span>-beta)*x2</code></pre>
<p><strong>Note that</strong> in this example, <code>d</code> begins with 2 in order to example to keep the example as simple as possible. In principal including individuals with just one prior observation is possible, and doing so improves estimates of <code>mu</code> and <code>t2</code>.</p>
<p>With unequal numbers of observations per person, an MVU estimate of <code>s2</code> can be still obtained by as a weighted average of the within person variances, where the weights are determined by the number of observations from that individual, as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># s2 estimates for the each individual</span>
s2_i    &lt;-<span class="st"> </span><span class="kw">tapply</span>(x,id,var)

<span class="co"># optimal weights</span>
w   &lt;-<span class="st"> </span>(k -<span class="st"> </span><span class="dv">1</span>) /<span class="st"> </span><span class="dv">2</span>

<span class="co"># an MVU estimate of s2</span>
(s2 &lt;-<span class="st"> </span><span class="kw">sum</span>(w*s2_i) /<span class="st"> </span><span class="kw">sum</span>(w))
<span class="co">#&gt; [1] 0.3503374</span></code></pre>
<p>The above estimate of <code>s2</code> is indeed the estimate for <code>s2</code> returned by <code>PEBparams(...,method='iterative')</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">params &lt;-<span class="st"> </span><span class="kw">PEBparams</span>(x,id,<span class="dt">method=</span><span class="st">'iterative'</span>)
params$s2
<span class="co">#&gt; [1] 0.3503374</span></code></pre>
<p>Unfortunately, closed form MVU estimates of <code>mu</code> and <code>s2</code> are not available. The <code>mu</code> parameter is most accurately thought of as the average of the personal averages. With unequal numbers of prior observations, an MVU estimate of <code>mu</code> will be a weighted average of the set of personal means {<code>mu_i</code>} calculated as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r">mu_i &lt;-<span class="st"> </span><span class="kw">tapply</span>(x,id,mean)</code></pre>
<p>The relative weights applied to each element of <code>mu_i</code> would depend on the numbers of prior observations per person as well as relative magnitudes of <code>t2</code> and <code>s2</code>. Hence an MVU estimate of <code>mu</code> would rely on an MVU estimate of <code>t2</code>. On the other hand, the estimate of <code>t2</code> depends on an estimate of <code>mu</code> around which the sum of the squares is calculated.</p>
<p>The iterative process begins with a naive estimate of <code>mu</code> and <code>t2</code>, and iteratively re-calculates one parameter and then the other to approach an MVU estimate of each asymptotically. Details on these calculations can be found in here: <code>vignette('peb-iterative-method')</code>.</p>
<p>Note that in the case of equal numbers of observations from each individual in the prior population, the second and subsequent iterations of the estimation process do not change the parameter estimates. Hence, in the first example, <code>PEBparams(...,iterations=10)</code> could have been specified with no effect on the estimates.</p>
</div>
</div>
<div id="application-of-the-peb-algorithm" class="section level1">
<h1>Application of the PEB algorithm</h1>
<p>When using the PEB to assess whether or not an individual’s marker level is higher (or lower) than expected given her prior marker levels and the distribution of markers in the prior population, a threshold (quantile) is calculated such that the probability that her current marker level exceeds that threshold is <code>p = (1 - specificity)</code>. The data required to individual’s threshold depends on the estimated parameters (<code>mu</code>,<code>s2</code>, and <code>t2</code>), the number of prior observations from that individual (<code>n</code>) and the average (mean) of her prior observations (<code>ybar</code>).</p>
<p>To continue the previous example,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># number of random markers levels to generate for our fictitious person </span>
y_k &lt;-<span class="st"> </span><span class="dv">6</span>

<span class="co"># randomly generate a 'true' personal mean </span>
y_mean &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>)*<span class="kw">sqrt</span>(beta)

<span class="co"># residuals around her 'true' personal mean </span>
y_resid &lt;-<span class="st"> </span><span class="kw">rnorm</span>(y_k)*<span class="kw">sqrt</span>(<span class="dv">1</span>-beta)

<span class="co"># a vector of random marker levels for an individual from our fictitious</span>
<span class="co"># population</span>
y &lt;-<span class="st"> </span>y_mean +<span class="st"> </span>y_resid

<span class="co"># divide the vector into prior and current marker levels</span>
(y_current &lt;-<span class="st"> </span>y[y_k])
<span class="co">#&gt; [1] 0.2130402</span>
(y_past &lt;-<span class="st"> </span>y[-y_k])
<span class="co">#&gt; [1] 1.5367301 1.8015176 0.5134604 0.6799848 0.1585988</span></code></pre>
<p>Now, in order to evaluate whether or not the <code>y_current</code> is unexpectedly high, with specificity 95%, a threshold can be calculated using <code>threshold = qpeb(...)</code>, and the current biomarker value (<code>y_current</code>) is considered to be elevated, if <code>y_current &gt; threshold</code>, as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r">threshold &lt;-<span class="st"> </span><span class="kw">qpeb</span>(<span class="dt">p=</span><span class="fl">0.95</span>,<span class="co"># set threshold with 95% specificity</span>
            <span class="dt">n=</span><span class="kw">length</span>(y_past),
            <span class="dt">ybar=</span><span class="kw">mean</span>(y_past),
            <span class="dt">mu=</span>params$mu,
            <span class="dt">sigma2=</span>params$s2,
            <span class="dt">tau2=</span>params$t2)

<span class="kw">qpeb</span>(<span class="dt">p=</span><span class="fl">0.95</span>, <span class="dt">n=</span><span class="dv">5</span>, <span class="dt">ybar=</span>.<span class="dv">2</span>, <span class="dt">mu=</span><span class="dv">0</span>, <span class="dt">sigma2=</span>.<span class="dv">5</span>, <span class="dt">tau2=</span>.<span class="dv">5</span>)
<span class="co">#&gt; [1] 1.422944</span>

(currentIsElevated &lt;-<span class="st"> </span>(y_current &gt;<span class="st"> </span>threshold))
<span class="co">#&gt; [1] FALSE</span></code></pre>
<p>If the variable <code>currentIsElevated</code> is <code>TRUE</code>, then y_current is considered ‘elevated’ with 95% specificity by the PEB.</p>
<p>Note that instead of passing each parameter explicitly, the <code>params</code> object returned by <code>PEBparams()</code> can be passed instead, as in:</p>
<pre class="sourceCode r"><code class="sourceCode r">threshold &lt;-<span class="st"> </span><span class="kw">qpeb</span>(<span class="dt">p=</span><span class="fl">0.95</span>,<span class="co"># set threshold with 95% specificity</span>
            <span class="dt">n=</span><span class="kw">length</span>(y_past),
            <span class="dt">ybar=</span><span class="kw">mean</span>(y_past),
            params)</code></pre>
<p>An alternative to calculating a threshold and determining if the current biomarker value exceeds that value is to calculate the probability of the current value conditional on her history and the distribution of the biomarker in the prior population by using <code>ppeb(...)</code> and testing whether the probability exceeds the specificity level, as in:</p>
<pre class="sourceCode r"><code class="sourceCode r">prob &lt;-<span class="st"> </span><span class="kw">ppeb</span>(y_current,
            <span class="dt">n=</span><span class="kw">length</span>(y_past),
            <span class="dt">ybar=</span><span class="kw">mean</span>(y_past),
            params)

specificity &lt;-<span class="st"> </span><span class="fl">0.95</span>
(currentIsElevated &lt;-<span class="st"> </span>(prob &gt;<span class="st"> </span>specificity))
<span class="co">#&gt; [1] FALSE</span></code></pre>
<p>In the above calls to <code>qpeb()</code> and <code>ppeb()</code>, the number and average of the previous biomarker level from the same individual were calculated explicitly and passed to <code>ppeb()</code> as parameters. However, if the parameters <code>n</code> and <code>ybar</code> are not provided, <code>qpeb()</code> and <code>ppeb()</code> will calculate <code>n</code> and <code>ybar</code> for each value in y using the assumption that y is a vector containing a series of marker results from a <strong>single</strong> individual, as in:</p>
<pre class="sourceCode r"><code class="sourceCode r">probs &lt;-<span class="st"> </span><span class="kw">ppeb</span>(y,params)
(currentIsElevated &lt;-<span class="st"> </span>(probs[y_k] &gt;<span class="st"> </span><span class="fl">0.95</span>))
<span class="co">#&gt; [1] FALSE</span></code></pre>
</div>
<div id="sample-size-requirements" class="section level1">
<h1>Sample Size requirements</h1>
<p>In practice, reasons for setting thresholds at a given specificity include (1) that insufficiently elevated marker levels are not indicative of a given outcome (disease), and (2) that a positive test may require follow up examinations or procedures which are costly or involve risks that an individual who is not at sufficient risk want to avoid. For these reasons, it is necessary to ensure that the range of False Positive Rates (FPRs) that are likely to result from the application of the PEB algorithm is reasonably narrow.</p>
<p>Deviations from the expected FPR [ = 1 - specificity] may result from random variation in the estimates of the parameters <code>mu</code>, <code>s2</code>, and <code>mu</code>, as well as from failure of the biomarker to follow a normal distributed within-individuals, between-individuals, or both. In practice it is often necessary to apply a transformation (such as the log-transformation) to the biomarker prior to applying the PEB algorithm. However, failure of the biomarker to meet assumptions on it’s distribution is beyond the topic of this discussion.</p>
<p>Because the effective sample sizes used to estimate the <code>t2</code> and <code>s2</code> parameters are smaller than that of the <code>mu</code> parameter, errors in <code>t2</code> and <code>s2</code> are likely to make greater contributions to deviations from the expected FPR. (See the PDF for discussion on the effective sample sizes of each parameter estimate.) Fortunately, the function <code>qpeb</code> can provide confidence intervals around the expected FPR. **Note that the confidence intervals provided by <code>qpeb</code> account only for random deviations in the estimates of the parameters <code>t2</code> and <code>s2</code> and not for the deviations in the estimate of <code>mu</code>.*.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qpeb</span>(<span class="dt">p =</span> <span class="fl">0.95</span>,
    params,
    <span class="dt">n=</span><span class="kw">seq</span>(<span class="dv">0</span>,y_k<span class="dv">-1</span>),
    <span class="dt">ybar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">cumsum</span>(y)/<span class="kw">seq</span>(y_k))[-y_k +<span class="st"> </span><span class="dv">1</span>],
    <span class="dt">conf.level=</span><span class="fl">0.9</span>)
<span class="co">#&gt;      quantile p.lower.CI p.upper.CI</span>
<span class="co">#&gt; [1,] 1.883301  0.9170615  0.9833553</span>
<span class="co">#&gt; [2,] 2.338174  0.9243910  0.9769204</span>
<span class="co">#&gt; [3,] 2.519474  0.9252517  0.9755134</span>
<span class="co">#&gt; [4,] 2.229333  0.9249069  0.9751958</span>
<span class="co">#&gt; [5,] 1.931069  0.9243830  0.9751907</span>
<span class="co">#&gt; [6,] 1.818896  0.9238898  0.9752820</span></code></pre>
<p>Note that the confidence intervals on the FPR depend on (1) the size and structure of the prior population, (2) the ICC, and (3) number of observations in the individual’s history. Notably, the confidence intervals do not depend on the individual’s personal average, and in the case of determining if a particular parameter set is sufficient, the confidence intervals produced by <code>PEB.conf.int</code> can be inspected without the need for a set of observations to evaluate, as in:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">PEB.conf.int</span>(<span class="dt">p=</span><span class="fl">0.95</span>, <span class="dt">n=</span><span class="dv">5</span>, <span class="dt">conf.level=</span><span class="fl">0.9</span>, <span class="dt">params=</span>params)
<span class="co">#&gt;      n p.lower.CI p.upper.CI</span>
<span class="co">#&gt; [1,] 0  0.9170615  0.9833553</span>
<span class="co">#&gt; [2,] 1  0.9243910  0.9769204</span>
<span class="co">#&gt; [3,] 2  0.9252517  0.9755134</span>
<span class="co">#&gt; [4,] 3  0.9249069  0.9751958</span>
<span class="co">#&gt; [5,] 4  0.9243830  0.9751907</span>
<span class="co">#&gt; [6,] 5  0.9238898  0.9752820</span></code></pre>
<p>Finally, note that depending on the ICC and the structure of the prior population, the confidence intervals may go from narrow to wide, or vice versa with increasing numbers of prior observations in the individual’s history, because the total variation and within person variation estimates are statistically independent. Hence, it is necessary to produce confidence intervals for a range of prior observations in order to assess the sufficiency of a particular prior when calculating parameters for the PEB algorithm.</p>
</div>
<div id="comparison-of-the-iterative-and-icc1-methods" class="section level1">
<h1>Comparison of the ‘iterative’ and ‘ICC1’ methods</h1>
<p>The parameters <code>s2</code> and <code>t2</code> are related to the Interclass Correlation Coefficient (beta) by the equation , which can be estimated using Analysis of Variance methods via</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(multilevel)
beta &lt;-<span class="st"> </span>multilevel::<span class="kw">ICC1</span>(<span class="kw">aov</span>(x~id))</code></pre>
<p>And with the estimate of <code>beta</code> the PEB parameters <code>s2</code> and <code>t2</code> can be estimated as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r">V  &lt;-<span class="st">  </span><span class="kw">var</span>(x)
s2 &lt;-<span class="st"> </span>(<span class="dv">1</span>-beta) *<span class="st"> </span>V
t2 &lt;-<span class="st"> </span>beta *<span class="st"> </span>V
mu &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</code></pre>
<p>However, the above estimate of the total variance (<code>V = var(x)</code>) becomes biased as beta approaches 1 (which is <em>exactly</em> when the PEB is most desireable) because it does not take into account correlations in the elements of x within groups/individuals. In addition, when the numbers of observation per individual in the prior population are not equal the estimate of <code>mu</code> is sub-optimal.</p>
<p>Although estimates of the within group (<code>s2</code>) and total variance (V = s2 + t2) parameters tend to be less biased under the iterative method, the expected differences between estimates <code>s2</code> adn <code>t2</code> are dwarfed by their standard deviation (Tables 1 and 2, below). Furthermore, the standard deviations of each parameter is similar under both methods, which suggests that neither method is substantially superior to the other in terms of accuracy of the PEB thresholds. The remaining advantage of the iterative method (in this implementation) is that the range of FPRs that can be expected when using PEB algorithm with a particular set of parameters can calculated along side the thresholds (via <code>qpeb(...,confl.evel=0.95)</code>), or on their own (via <code>PEB.conf.int()</code>).</p>
<p>The tables below compare the differences (1) differences between the mean parameter estimate and it true value and (2) the standard deviation of each parameter using the ICC and iterative method, with 1,2, or 10 iterations with the iterative method. These following tables are the result of the simulation study below in which 10,000 prior populations were generated with 20 individuals each of whom contributes 2,3, or 4 samples with equal probabilities, with several values of the ICC (beta) parameters.</p>
<p>Notice that estimates for <code>s2</code> and <code>V</code> are virtually unchanged with after the second iteration (Tables 2 and 3), and because estimates of <code>s2</code> are unchanged by the iterative process, only one estimate is presented for <code>s2</code> (Table 1).</p>
<table>
<caption>Bias (Standard Deviation) of <code>s2</code> estimates</caption>
<colgroup>
<col width="18%"></col>
<col width="20%"></col>
<col width="20%"></col>
<col width="20%"></col>
<col width="20%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">beta = 0.3</th>
<th align="center">beta = 0.5</th>
<th align="center">beta = 0.7</th>
<th align="center">beta = 0.9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>ICC1</strong></td>
<td align="center">-0.002743 (0.109)</td>
<td align="center">-0.007288 (0.079)</td>
<td align="center">-0.003475 (0.047)</td>
<td align="center">-0.001337 (0.016)</td>
</tr>
<tr class="even">
<td align="center"><strong>iterative</strong></td>
<td align="center">0.000537 (0.109)</td>
<td align="center">-0.003219 (0.079)</td>
<td align="center">-0.000013 (0.047)</td>
<td align="center">0.000168 (0.016)</td>
</tr>
</tbody>
</table>
<table>
<caption>Bias (Standard Deviation) of combined variance <code>V</code> estimates</caption>
<colgroup>
<col width="25%"></col>
<col width="18%"></col>
<col width="18%"></col>
<col width="18%"></col>
<col width="18%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">beta = 0.3</th>
<th align="center">beta = 0.5</th>
<th align="center">beta = 0.7</th>
<th align="center">beta = 0.9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>ICC1</strong></td>
<td align="center">-0.0134 (0.14)</td>
<td align="center">-0.0049 (0.17)</td>
<td align="center">-0.0085 (0.19)</td>
<td align="center">-0.0135 (0.21)</td>
</tr>
<tr class="even">
<td align="center"><strong>1 iteration</strong></td>
<td align="center">-0.0043 (0.14)</td>
<td align="center">0.0071 (0.17)</td>
<td align="center">0.0049 (0.19)</td>
<td align="center">0.0057 (0.22)</td>
</tr>
<tr class="odd">
<td align="center"><strong>2 iterations</strong></td>
<td align="center">-0.0062 (0.14)</td>
<td align="center">0.0062 (0.17)</td>
<td align="center">0.0046 (0.19)</td>
<td align="center">0.0056 (0.22)</td>
</tr>
<tr class="even">
<td align="center"><strong>10 iterations</strong></td>
<td align="center">-0.0062 (0.14)</td>
<td align="center">0.0062 (0.17)</td>
<td align="center">0.0046 (0.19)</td>
<td align="center">0.0056 (0.22)</td>
</tr>
</tbody>
</table>
<table>
<caption>Bias (Standard Deviation) of Population Mean Estimates</caption>
<colgroup>
<col width="24%"></col>
<col width="19%"></col>
<col width="19%"></col>
<col width="18%"></col>
<col width="18%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">beta = 0.3</th>
<th align="center">beta = 0.5</th>
<th align="center">beta = 0.7</th>
<th align="center">beta = 0.9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>ICC1</strong></td>
<td align="center">-0.00049 (0.12)</td>
<td align="center">-0.00344 (0.14)</td>
<td align="center">0.00508 (0.14)</td>
<td align="center">0.00201 (0.16)</td>
</tr>
<tr class="even">
<td align="center"><strong>1 iteration</strong></td>
<td align="center">-0.00031 (0.11)</td>
<td align="center">-0.00284 (0.13)</td>
<td align="center">0.00427 (0.14)</td>
<td align="center">0.00060 (0.15)</td>
</tr>
<tr class="odd">
<td align="center"><strong>2 iterations</strong></td>
<td align="center">-0.00032 (0.11)</td>
<td align="center">-0.00284 (0.13)</td>
<td align="center">0.00427 (0.14)</td>
<td align="center">0.00060 (0.15)</td>
</tr>
<tr class="even">
<td align="center"><strong>10 iterations</strong></td>
<td align="center">-0.00032 (0.11)</td>
<td align="center">-0.00284 (0.13)</td>
<td align="center">0.00427 (0.14)</td>
<td align="center">0.00060 (0.15)</td>
</tr>
</tbody>
</table>
<div id="code-for-the-simulation-study" class="section level3">
<h3>Code for the simulation study</h3>
<pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="dv">40</span> <span class="co"># number of individuals in the prior population</span>
d =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">2</span>,<span class="dv">4</span>) <span class="co"># distribution of maximum numbers of prior observations per individual</span>
n1 =<span class="st"> </span><span class="dv">500</span> <span class="co"># number of random population structures to simulate</span>
n2 =<span class="st"> </span><span class="dv">20</span> <span class="co"># number of iterations per population structure</span>

beta &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">3</span>,.<span class="dv">5</span>,.<span class="dv">7</span>,.<span class="dv">9</span>) <span class="co"># ICC parameters</span>

<span class="co"># INITIALIZE CONTAINERS</span>
out_ICC1 &lt;-<span class="st"> </span>
out_Iter1 &lt;-<span class="st"> </span>
out_Iter2 &lt;-<span class="st"> </span>
out_Iter10 &lt;-<span class="st"> </span><span class="ot">NULL</span>

flds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'s2'</span>,<span class="st">'t2'</span>,<span class="st">'mu'</span>)

for(i in <span class="kw">seq</span>(n1)){
    <span class="co"># generate the population structure</span>
    k &lt;-<span class="st"> </span><span class="kw">sample</span>(d,m,<span class="dt">replace=</span><span class="ot">TRUE</span>)
    .id =<span class="st"> </span><span class="kw">rep</span>(<span class="kw">seq</span>(m),<span class="dt">times=</span>k)
    id =<span class="st"> </span><span class="kw">factor</span>(.id, <span class="dt">levels=</span><span class="kw">seq</span>(m))

    for(j in <span class="kw">seq</span>(n2)){

        tmp_ICC1 &lt;-<span class="st"> </span>
<span class="st">        </span>tmp_Iter1 &lt;-<span class="st"> </span>
<span class="st">        </span>tmp_Iter2 &lt;-<span class="st"> </span>
<span class="st">        </span>tmp_Iter10 &lt;-<span class="st"> </span><span class="kw">c</span>()

        for(b1 in beta){ 
            <span class="co">#generate the randoms</span>
            x1 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">rnorm</span>(m),<span class="dt">times=</span>k)
            x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">sum</span>(k)) 
            x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(b1)*x1 +<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span>-b1)*x2

            tmp_ICC1    &lt;-<span class="st"> </span><span class="kw">c</span>(tmp_ICC1   ,<span class="kw">unlist</span>(<span class="kw">PEBparams</span>(x,id,<span class="dt">method=</span><span class="st">'ICC1'</span>)[flds]))
            tmp_Iter1   &lt;-<span class="st"> </span><span class="kw">c</span>(tmp_Iter1  ,<span class="kw">unlist</span>(<span class="kw">PEBparams</span>(x,id,<span class="dt">method=</span><span class="st">'iterative'</span>,<span class="dt">iterations=</span><span class="dv">1</span>)[flds]))
            tmp_Iter2   &lt;-<span class="st"> </span><span class="kw">c</span>(tmp_Iter2  ,<span class="kw">unlist</span>(<span class="kw">PEBparams</span>(x,id,<span class="dt">method=</span><span class="st">'iterative'</span>,<span class="dt">iterations=</span><span class="dv">2</span>)[flds]))
            tmp_Iter10  &lt;-<span class="st"> </span><span class="kw">c</span>(tmp_Iter10 ,<span class="kw">unlist</span>(<span class="kw">PEBparams</span>(x,id,<span class="dt">method=</span><span class="st">'iterative'</span>,<span class="dt">iterations=</span><span class="dv">10</span>)[flds]))

        }

    out_ICC1   &lt;-<span class="st"> </span><span class="kw">rbind</span>(out_ICC1   ,tmp_ICC1  )
    out_Iter1  &lt;-<span class="st"> </span><span class="kw">rbind</span>(out_Iter1  ,tmp_Iter1 )
    out_Iter2  &lt;-<span class="st"> </span><span class="kw">rbind</span>(out_Iter2  ,tmp_Iter2 )
    out_Iter10 &lt;-<span class="st"> </span><span class="kw">rbind</span>(out_Iter10 ,tmp_Iter10)

    }

    if(!<span class="st"> </span>(i %%<span class="st"> </span><span class="dv">10</span>))
        <span class="kw">cat</span>(<span class="st">'completed'</span>,i*n2,<span class="st">'iterations</span><span class="ch">\n</span><span class="st">'</span>)
}

<span class="co"># Convenience functions for calculating the SD and bias </span>
SD &lt;-<span class="st"> </span>function(x,exp)
    <span class="kw">sqrt</span>(<span class="kw">sum</span>((x -<span class="st"> </span>exp)^<span class="dv">2</span>)/<span class="kw">length</span>(x))
bias &lt;-<span class="st"> </span>function(x,exp){
    if(<span class="kw">missing</span>(exp))
        <span class="kw">mean</span>(x)
    else
        <span class="kw">mean</span>(x-exp)
}

<span class="co"># Summarize the SD's of the s2 estimates by beta</span>
V_sd &lt;-<span class="st"> </span>s2_sd &lt;-<span class="st"> </span>t2_sd  &lt;-<span class="st"> </span>mu_sd  &lt;-<span class="st">   </span>
V_bias &lt;-<span class="st"> </span>s2_bias &lt;-<span class="st"> </span>t2_bias &lt;-<span class="st"> </span>mu_bias   &lt;-<span class="st">  </span><span class="ot">NULL</span>
for(i in <span class="dv">1</span>:<span class="kw">length</span>(beta)){
    s2_bias &lt;-<span class="st"> </span><span class="kw">cbind</span>(s2_bias,
                  <span class="kw">c</span>(<span class="dt">ICC1  =</span> <span class="kw">bias</span>(out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>],<span class="dt">exp =</span> <span class="dv">1</span>-beta[i]),
                    <span class="dt">Iter1 =</span> <span class="kw">bias</span>(out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>],<span class="dt">exp =</span> <span class="dv">1</span>-beta[i])))
    V_bias &lt;-<span class="st"> </span><span class="kw">cbind</span>(V_bias,
                  <span class="kw">c</span>(<span class="dt">ICC1  =</span> <span class="kw">bias</span>(out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>),
                    <span class="dt">Iter1 =</span> <span class="kw">bias</span>(out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>),
                    <span class="dt">Iter2 =</span> <span class="kw">bias</span>(out_Iter2 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_Iter2 [,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>),
                    <span class="dt">Iter10=</span> <span class="kw">bias</span>(out_Iter10[,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_Iter10[,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>)))
    mu_bias &lt;-<span class="st"> </span><span class="kw">cbind</span>(mu_bias,
                  <span class="kw">c</span>(<span class="dt">ICC1  =</span> <span class="kw">bias</span>(out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>]),
                    <span class="dt">Iter1 =</span> <span class="kw">bias</span>(out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>]),
                    <span class="dt">Iter2 =</span> <span class="kw">bias</span>(out_Iter2 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>]),
                    <span class="dt">Iter10=</span> <span class="kw">bias</span>(out_Iter10[,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>])))
    s2_sd &lt;-<span class="st"> </span><span class="kw">cbind</span>(s2_sd,
                  <span class="kw">c</span>(<span class="dt">ICC1  =</span> <span class="kw">SD</span>(out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>],<span class="dt">exp =</span> <span class="dv">1</span>-beta[i]),
                    <span class="dt">Iter1 =</span> <span class="kw">SD</span>(out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>],<span class="dt">exp =</span> <span class="dv">1</span>-beta[i])))
    V_sd &lt;-<span class="st"> </span><span class="kw">cbind</span>(V_sd,
                  <span class="kw">c</span>(<span class="dt">ICC1  =</span> <span class="kw">SD</span>(out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>),
                    <span class="dt">Iter1 =</span> <span class="kw">SD</span>(out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>),
                    <span class="dt">Iter2 =</span> <span class="kw">SD</span>(out_Iter2 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_Iter2 [,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>),
                    <span class="dt">Iter10=</span> <span class="kw">SD</span>(out_Iter10[,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">1</span>] +<span class="st"> </span>out_Iter10[,<span class="dv">3</span>*(i<span class="dv">-1</span>) +<span class="st"> </span><span class="dv">2</span>],<span class="dt">exp =</span> <span class="dv">1</span>)))
    mu_sd &lt;-<span class="st"> </span><span class="kw">cbind</span>(mu_sd,
                  <span class="kw">c</span>(<span class="dt">ICC1  =</span> <span class="kw">SD</span>(out_ICC1  [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>],<span class="dt">exp=</span><span class="dv">0</span>),
                    <span class="dt">Iter1 =</span> <span class="kw">SD</span>(out_Iter1 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>],<span class="dt">exp=</span><span class="dv">0</span>),
                    <span class="dt">Iter2 =</span> <span class="kw">SD</span>(out_Iter2 [,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>],<span class="dt">exp=</span><span class="dv">0</span>),
                    <span class="dt">Iter10=</span> <span class="kw">SD</span>(out_Iter10[,<span class="dv">3</span>*(i<span class="dv">-1</span>)+<span class="dv">3</span>],<span class="dt">exp=</span><span class="dv">0</span>)))
}

<span class="co"># set dim names of the output tables. </span>
DNs2  &lt;-<span class="st">  </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">'ICC1'</span>, <span class="st">'iterative'</span>),
                     <span class="kw">paste</span>(<span class="st">'beta ='</span>,beta))
DN  &lt;-<span class="st">  </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">'ICC1'</span>, <span class="st">'1 iteration'</span>, <span class="st">'2 iterations'</span>, <span class="st">'10 iterations'</span>),
                     <span class="kw">paste</span>(<span class="st">'beta ='</span>,beta))

table1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">paste</span>(<span class="kw">format</span>(s2_bias,<span class="dt">digits=</span><span class="dv">2</span>,<span class="dt">scientific=</span><span class="ot">FALSE</span>),
                                  <span class="st">' ('</span>,<span class="kw">format</span>(s2_sd,<span class="dt">digits=</span><span class="dv">2</span>),<span class="st">')'</span>,
                                  <span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dv">2</span>,<span class="dv">4</span>,<span class="dt">dimnames=</span>DNs2)
table2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">paste</span>(<span class="kw">format</span>(V_bias ,<span class="dt">digits=</span><span class="dv">2</span>),
                                  <span class="st">' ('</span>,<span class="kw">format</span>(V_sd ,<span class="dt">digits=</span><span class="dv">2</span>),<span class="st">')'</span>
                                  ,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dv">4</span>,<span class="dv">4</span>,<span class="dt">dimnames=</span>DN)
table3 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">paste</span>(<span class="kw">format</span>(mu_bias,<span class="dt">digits=</span><span class="dv">2</span>),
                                  <span class="st">' ('</span>,<span class="kw">format</span>(mu_sd,<span class="dt">digits=</span><span class="dv">2</span>),<span class="st">')'</span>,
                                  <span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dv">4</span>,<span class="dv">4</span>,<span class="dt">dimnames=</span>DN)</code></pre>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
