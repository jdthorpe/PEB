<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Jason Thorpe [ jdthorpe_at_gmail_dot_com ]" />

<meta name="date" content="2015-04-21" />

<title>PEB Quick Start Guide</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">PEB Quick Start Guide</h1>
<h4 class="author"><em>Jason Thorpe [ jdthorpe_at_gmail_dot_com ]</em></h4>
<h4 class="date"><em>2015-04-21</em></h4>
</div>


<div id="calculating-required-parameters" class="section level2">
<h2>Calculating Required Parameters</h2>
<p>When using the Parametric Empirical Bayes (PEB) algorithm to set personalized thresholds for a biomarker, it is necessary estimate the population average (<span class="math">\(\mu\)</span>,<code>mu</code>) for the biomarker as well as the within- and between-person variation of that marker (sigma squared [<span class="math">\(\sigma^2\)</span>,<code>s2</code>] and tau squared[<span class="math">\(\tau^2\)</span>,<code>t2</code>], respectively). A dataset with observed marker levels from a population of unaffected individuals is required, with multiple observations for at least some observations.</p>
<p>The function <code>PEBparams()</code> calculates <em>intital</em> estimates for <code>mu</code>, <code>s2</code>, and <code>t2</code>, as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'PEB'</span>)
<span class="kw">head</span>(myData,<span class="dv">10</span>)
<span class="co">#&gt;    person markerLevels</span>
<span class="co">#&gt; 1       a        104.6</span>
<span class="co">#&gt; 2       a         98.8</span>
<span class="co">#&gt; 3       b        109.7</span>
<span class="co">#&gt; 4       b        107.7</span>
<span class="co">#&gt; 5       b        112.9</span>
<span class="co">#&gt; 6       c        102.7</span>
<span class="co">#&gt; 7       c        106.7</span>
<span class="co">#&gt; 8       c        110.4</span>
<span class="co">#&gt; 9       c        105.4</span>
<span class="co">#&gt; 10      d         93.8</span>
params &lt;-<span class="st"> </span><span class="kw">PEBparams</span>(<span class="dt">x=</span>myData$markerLevels,
                    <span class="dt">id=</span>myData$person)
params
<span class="co">#&gt; mu: 101.1</span>
<span class="co">#&gt; sigma^2: 5.814</span>
<span class="co">#&gt; tau^2: 21.11</span>
<span class="co">#&gt; Calculated using 57 observations, from  20 inidividuals.</span></code></pre>
</div>
<div id="calculating-a-personalized-threshold" class="section level2">
<h2>Calculating a personalized threshold</h2>
<p>In order to evaluate whether or not an individual’s current marker levels (<code>y_current</code>) is unexpectedly high, with fixed specificity given her personal history (‘y_past’) and her membership in the population, a threshold can be calculated using <code>threshold = qpeb(...)</code>, as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># let's use person 'a' as an example.  Her prior values are:</span>
(<span class="dt">y_past =</span> myData$markerLevels [myData$person ==<span class="st"> 'a'</span>])
<span class="co">#&gt; [1] 104.6  98.8</span>

<span class="co"># and a personalized threshold with 95% specificity can be set via:</span>
<span class="kw">qpeb</span>(<span class="dt">p=</span><span class="fl">0.95</span>,<span class="co"># specificity level</span>
     <span class="dt">n=</span><span class="kw">length</span>(y_past),
     <span class="dt">ybar=</span><span class="kw">mean</span>(y_past),
     <span class="dt">mu=</span>params$mu,
     <span class="dt">sigma2=</span>params$s2,
     <span class="dt">tau2=</span>params$t2)
<span class="co">#&gt; [1] 106.3839</span>

<span class="co"># or simply:</span>
<span class="kw">qpeb</span>(<span class="dt">p=</span><span class="fl">0.95</span>,<span class="co"># specificity level</span>
     <span class="dt">n=</span><span class="kw">length</span>(y_past),
     <span class="dt">ybar=</span><span class="kw">mean</span>(y_past),
     params)
<span class="co">#&gt; [1] 106.3839</span></code></pre>
<p>Hence, if her next marker level (<code>y_current</code>) exceeds 106.38, we can say that her marker is elevated with 95% specificity.</p>
</div>
<div id="determining-a-personalized-significance-level" class="section level2">
<h2>Determining a personalized significance level</h2>
<p>An alternative to calculating a threshold is to calculate the quantile of the current value conditional on her history and the distribution of the biomarker in the population using <code>ppeb(...)</code>, as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r">y_current &lt;-<span class="st"> </span><span class="fl">105.8</span>
<span class="kw">ppeb</span>(y_current,
     <span class="dt">n=</span><span class="kw">length</span>(y_past),
     <span class="dt">ybar=</span><span class="kw">mean</span>(y_past),
     params)
<span class="co">#&gt; [1] 0.9254941</span></code></pre>
<p>In the above calls to <code>qpeb()</code> and <code>ppeb()</code>, the number and average of the previous biomarker level from the same individual were calculated explicitly and passed to <code>ppeb()</code> as parameters. However, if the parameters <code>n</code> and <code>ybar</code> are not provided, <code>qpeb()</code> and <code>ppeb()</code> will calculate <code>n</code> and <code>ybar</code> for each value in y using the assumption that y is a vector containing a series of marker results from a <strong>single</strong> individual, as in:</p>
<pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">c</span>(y_past,
       y_current)
<span class="kw">ppeb</span>(y,params)
<span class="co">#&gt; [1] 0.75097073 0.05876752 0.92549405</span></code></pre>
</div>
<div id="accuracy-of-specificity-levels" class="section level2">
<h2>Accuracy of Specificity Levels</h2>
<p>Because the accuracy the specificity for each threshold depends on the sample sizes used to calculate the PEB parameters, it is useful to estimate the accuracy of the specificity of PEB thresholds. This can be accomplished by using the ‘iterative’ method to calculate the PEB parameters, and specifying the <code>conf.level</code> parameter of <code>qpeb()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the parameters using the Iterative method</span>
params_iterative &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">PEBparams</span>(<span class="dt">x=</span>myData$markerLevels,
              <span class="dt">id=</span>myData$person,
              <span class="dt">method=</span><span class="st">'iterative'</span>)

<span class="kw">qpeb</span>(<span class="dt">p =</span> <span class="fl">0.95</span>,
    params_iterative,
    <span class="dt">n=</span><span class="kw">length</span>(y_past),
    <span class="dt">ybar=</span><span class="kw">mean</span>(y_past),
    <span class="dt">conf.level=</span><span class="fl">0.9</span>)
<span class="co">#&gt;      quantile p.lower.CI p.upper.CI</span>
<span class="co">#&gt; [1,] 106.4361  0.9067381  0.9864734</span></code></pre>
<p>Notice that the threshold has changed slightly (106.44, up from 106.38) with the ‘iterative’ method, and that the confidence interval for the false positive rate is fairly wide (<code>[90.7%,98.6%]</code>), indicating that our initial dataset with 57 observations from 20 individuals may be too small to estimate thresholds with sufficient precision for many applications.</p>
<p>For a complete discussion on the PEB parameters, see <code>vignette('peb-parameters')</code></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
